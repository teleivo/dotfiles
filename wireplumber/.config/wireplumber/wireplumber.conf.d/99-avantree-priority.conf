# WirePlumber configuration to set Avantree C81 headset as default audio device
# This fixes the issue where Rhythmbox plays through internal speakers instead of Bluetooth headset
# The configuration uses device properties and node name patterns to ensure stable device identification

monitor.alsa.rules = [
  {
    # First rule: Match the Avantree device by its stable hardware properties
    # This ensures the device itself is prioritized and uses the correct profile
    matches = [
      {
        # Match Avantree C81 device by stable USB bus ID (doesn't change on reconnect)
        device.bus-id = "usb-Avantree_Avantree_C81_PC__6502DEFA4F2179BD8F47-02"
        device.form_factor = "headset"
      }
    ]
    actions = {
      update-props = {
        # Set higher priority to make this the preferred default device
        # Default priority is usually ~1000, so 1050 ensures this device is selected
        priority.driver = 1050
        priority.session = 1050
        device.description = "Avantree C81 (Preferred Audio)"
        # Force duplex profile to enable both output and microphone input
        device.profile = "output:analog-stereo+input:mono-fallback"
      }
    }
  }
  {
    # Second rule: Match the actual audio output nodes created for this device
    # This handles the dynamic node names that include suffixes like .29, .30, etc.
    matches = [
      {
        # Use regex pattern to match any Avantree output node regardless of suffix
        node.name = "~alsa_output.usb-Avantree_Avantree_C81_PC__6502DEFA4F2179BD8F47-02.analog-stereo.*"
      }
    ]
    actions = {
      update-props = {
        # Set higher priority for the sink node to ensure it becomes default
        priority.driver = 1050
        priority.session = 1050
        node.description = "Avantree C81 Audio Output (Default)"
      }
    }
  }
]