#!/bin/bash

# Audio music setup script
# Switches to output-only profile, mutes mic, ensures output is unmuted at 30%

# Source common audio utilities
source "$(dirname "$0")/audio-utils"

# Switch to output-only profile (only for headsets)
card_id=$(get_headset_card_id)
if [[ -n "$card_id" ]]; then
    pactl set-card-profile "$card_id" output:analog-stereo
fi

# Mute microphone
pactl set-source-mute @DEFAULT_SOURCE@ 1

# Unmute default sink and ensure minimum 30% volume
pactl set-sink-mute @DEFAULT_SINK@ 0
current_vol=$(pactl get-sink-volume @DEFAULT_SINK@ | grep -oP '\d+%' | head -1 | tr -d '%')
if [[ "$current_vol" -lt 30 ]]; then
    pactl set-sink-volume @DEFAULT_SINK@ 30%
fi

dunstify "Audio Music" "Music mode activated - Mic: muted, Output: unmuted" --icon=audio-headphones