---
- name: Install sway and related packages
  become: true
  apt:
    pkg:
      - sway
      - swaybg
      - swayidle
      - swaylock
      - fuzzel
      - xdg-desktop-portal-wlr
      - stow
    state: present

- name: Ensure config folders exist
  file:
    path: "{{ item }}"
    state: directory
  loop:
    - ~/.config/sway
    - ~/.config/swaylock
    - ~/.config/fuzzel
    - ~/.config/xdg-desktop-portal
    - ~/.config/xdg-desktop-portal-wlr

- name: Create symlinks into dotfiles
  command: stow --target ~/ {{ item }}
  args:
    chdir: ~/code/dotfiles
  loop:
    - sway
    - swaylock
    - fuzzel
    - xdg-desktop-portal
  changed_when: false  # command module always shows changed; stow is idempotent, failures still detected via exit code
