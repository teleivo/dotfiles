---
- name: Install GNU Stow symlink manager
  become: true
  apt:
    state: "{{ apt_package_state }}"
    name: stow

- name: Ensure required configuration directories exist
  file:
    path: "{{ item }}"
    state: directory
  loop:
    - ~/bin
    - ~/.config/git
    - ~/.config/fd
    - ~/.config/rg
    - ~/.config/swaylock
    - ~/.config/yazi
    - ~/.config/pipewire
    - ~/.config/wireplumber
    - ~/.config/systemd/user
    - ~/.config/nerd-dictation
    - ~/.local/share/applications

- name: Create dotfile symlinks using GNU Stow
  command:
    argv:
      - stow
      - --target
      - ~/
      - --restow
      - --stow
      - alias
      - bin
      - chrome
      - claude
      - dunst
      - fd
      - fuzzel
      - git
      - kanshi
      - psql
      - rg
      - shell
      - solaar
      - sway
      - swaylock
      - waybar
      - xdg-desktop-portal
      - yazi
      - pipewire
      - wireplumber
      - systemd
      - nerd-dictation
  args:
    chdir: ~/code/dotfiles
